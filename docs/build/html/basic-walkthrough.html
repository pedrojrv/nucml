

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Basic Walkthrough &mdash; NucML 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Loading Data" href="navigating-the-nde.html" />
    <link rel="prev" title="Installation Guide" href="installation-guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> NucML
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">OVERVIEW</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what-is-nucml.html">What is NucML?</a></li>
</ul>
<p class="caption"><span class="caption-text">GET STARTED</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation-guide.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Walkthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#load-the-neutrons-exfor-data">1. Load the Neutrons EXFOR Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-ml-models">2. Building the ML Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-benchmark-files">4. Generating Benchmark Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validating-the-ml-models">5. Validating the ML Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">6. Next Steps</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">NAVIGATING THE NDE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="navigating-the-nde.html">Loading Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigating-the-nde.html#exploratory-data-analysis">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigating-the-nde.html#modeling-data">Modeling Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigating-the-nde.html#processing-data-for-monte-carlo">Processing Data for Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigating-the-nde.html#validating-using-benchmarks">Validating using Benchmarks</a></li>
</ul>
<p class="caption"><span class="caption-text">DOCUMENTATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nucml.html">nucml package</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ AND CONTACT</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NucML</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Basic Walkthrough</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/basic-walkthrough.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note" id="basic-walkthrough-label">
<p class="admonition-title">Note</p>
<p>Documentation in progress.</p>
</div>
<div class="section" id="basic-walkthrough">
<h1>Basic Walkthrough<a class="headerlink" href="#basic-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>The cloned repository does not only contain the information necessary to start generating the datasets but also a variety of
tutorial notebooks that demonstrate the capabilities of NucML. Be sure to check them out. For more information in the contents please
refer to the repository README file in GitHub. If you haven’t installed NucmL yet, please follow the instructions in
the <a class="reference internal" href="installation-guide.html#installation-guide-label"><span class="std std-ref">Installation Guide</span></a>.</p>
<p>In this section we summarize the main pipeline steps for a complete nuclear data neutron-induce cross section evaluation including
loading the data, modeling, and validating using criticality benchmarks.</p>
<div class="section" id="load-the-neutrons-exfor-data">
<h2>1. Load the Neutrons EXFOR Data<a class="headerlink" href="#load-the-neutrons-exfor-data" title="Permalink to this headline">¶</a></h2>
<p>The <cite>nucml.datasets</cite> module offers the capability of loading various datasets from AME, ENSDF, ENDF, and EXFOR easily. In this example
we load the EXFOR/AME dataset for neutron-induce reactions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first we import the datasets module</span>
<span class="kn">import</span> <span class="nn">nucml.datasets</span> <span class="k">as</span> <span class="nn">nuc_data</span>

<span class="c1"># We can then load the EXFOR data.</span>
<span class="n">data</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">to_scale</span><span class="p">,</span> <span class="n">scaler</span> <span class="o">=</span> <span class="n">nuc_data</span><span class="o">.</span><span class="n">load_exfor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;neutrons&quot;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">low_en</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_en</span><span class="o">=</span><span class="mf">2.0E7</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basic</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a couple of things going on when loading the data. It starts by setting <cite>mode=”neutrons”</cite> meaning we only want
datapoints for neutron-induce reactions.  The <cite>log</cite> arguments specifies that we want the Cross
Section and Incident Energy data in log form. These are highly skewed features that benefit from this transformation.
The <cite>low_en</cite> arguments tells the loading function that we only want low energy points (up to 2.0E7 eV).</p>
<p>The EXFOR dataset contains a lot of information including Author, Institutions, Dates, and more. This is generally
not useful for a ML model. We tell the loader function by setting <cite>num=True</cite> that we only want useful numerical
and categorical data. This will automatically one-hot encode categorical variables. The <cite>normalize=True</cite> makes sure
that the data is normalized using a standard scaler. There are other transformers avaliable.</p>
<p>The <cite>basic</cite> argument specifies the complexity of the dataset in terms of features included. See the documentation
for more information. In this example <cite>basic=0</cite> means that we only want the most basic features
(Energy, Data, Z, N, A, MT, Center of Mass Flag, Target Flag).</p>
<p>The loader returns eight objects:</p>
<ul class="simple">
<li><p>data: The original numerical dataset.</p></li>
<li><p>x_train and y_train: The trainining data and labels.</p></li>
<li><p>x_test and y_test: The testing data and labels.</p></li>
<li><p>to_scale: A list of the features subject to normalization by the scaler.</p></li>
<li><p>scaler: A scikit-learn scaler object. This is the transformer used to normalized the data.</p></li>
</ul>
</div>
<div class="section" id="building-the-ml-models">
<h2>2. Building the ML Models<a class="headerlink" href="#building-the-ml-models" title="Permalink to this headline">¶</a></h2>
<p>Building the model is user dependent. There are a variety of models and an infinite number of hyperparameter combinations. Tuning
these models are outside the scope of this utility but here a simple Decision Tree model will be trained for demonstration purposes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># importing the tree model from sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>

<span class="c1"># initalizing the model instance</span>
<span class="n">dt_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># training the model</span>
<span class="n">dt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<p>You can evaluate the model with various performance metrics. NucML provides a convinience function that allows you to calculate
all performance metrics easily.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import nucml modelling utilities</span>
<span class="kn">import</span> <span class="nn">nucml.model.model_utilities</span> <span class="k">as</span> <span class="nn">model_utils</span>

<span class="c1"># making model predictions to calculate metrics</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">dt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">dt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>

<span class="c1"># getting performance metrics using NucML</span>
<span class="n">train_error_metrics</span> <span class="o">=</span> <span class="n">model_utils</span><span class="o">.</span><span class="n">regression_error_metrics</span><span class="p">(</span><span class="n">y_hat_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">test_error_metrics</span> <span class="o">=</span> <span class="n">model_utils</span><span class="o">.</span><span class="n">regression_error_metrics</span><span class="p">(</span><span class="n">y_hat_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
<p>After training the model make sure to save it for later use in the validation phase. Remember to also save the scaler.
This latter object is often forgotted but is needed to tranform the same or new data in later work. Make sure the model
name is unique since it is probable you will train various models of the same type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The model name will be used to create a directory with the same name.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import joblib.dump to save the model and scaler</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span>

<span class="c1"># specify the path and names for the model and scaler</span>
<span class="n">model_saving_directory</span> <span class="o">=</span> <span class="s2">&quot;path/to/saving/directory/&quot;</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;dt_model_mss3_msl2_maxdepth20.joblib&quot;</span>
<span class="n">model_saving_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_saving_directory</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
<span class="n">scaler_saving_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_saving_directory</span><span class="p">,</span> <span class="s1">&#39;scaler.pkl&#39;</span><span class="p">)</span>

<span class="c1"># save the models and scaler</span>
<span class="n">dump</span><span class="p">(</span><span class="n">dt_model</span><span class="p">,</span> <span class="n">model_saving_path</span><span class="p">)</span>
<span class="n">dump</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">scaler_saving_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>In the next section we need to present a <cite>DataFrame</cite> to the ACE utilities to create model dependent benchmark files. The ACE module
is expecting a certain format containing at least the performance error metrics calculated in the previouse code snippet and the path
to the saved model and scaler. In this case we are saving a results <cite>DataFrame</cite> with only one row since we only trained one model
but in reality will include many more models.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># transform the obtained error metrics using the model utilities</span>
<span class="n">dt_results</span> <span class="o">=</span> <span class="n">model_utils</span><span class="o">.</span><span class="n">create_train_test_error_df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_error_metrics</span><span class="p">,</span> <span class="n">test_error_metrics</span><span class="p">)</span>

<span class="c1"># adding the paths to dt_results</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;model_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">model_saving_path</span><span class="p">)</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;scaler_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">scaler_saving_path</span><span class="p">)</span>

<span class="c1"># You can also append extra information</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;normalizer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;standard_scaler&quot;</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;max_depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt_model</span><span class="o">.</span><span class="n">get_depth</span><span class="p">()</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;mss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">dt_results</span><span class="p">[</span><span class="s2">&quot;msl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># save the results</span>
<span class="n">results_filepath</span> <span class="o">=</span> <span class="s2">&quot;path/to/saving/dir/dt_results.csv&quot;</span>
<span class="n">dt_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">results_filepath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>There are some python scripts included in the ML_Nuclear_Data to help you get started training scikit-learn and XGBoost models
easily. It is a great way to get get started and to experience some of the modeling capabilities of NucML and includes all necessary
code automate more of these tasks.</p>
</div>
<div class="section" id="generating-benchmark-files">
<h2>4. Generating Benchmark Files<a class="headerlink" href="#generating-benchmark-files" title="Permalink to this headline">¶</a></h2>
<p>While the benchmark library is small, NucML allows the user to add more benchmark files by following a set of instructions. It
is best practice to create benchmark files for all avaliable benchmarks. For demonstration we use only the U-233 Jezzebel
criticality benchmark.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the ace utilities</span>
<span class="kn">import</span> <span class="nn">nucml.ace.data_utilities</span> <span class="k">as</span> <span class="nn">ace_utils</span>

<span class="c1"># 1) specify directory where all benchmark files will be created</span>
<span class="n">dt_ml_ace_dir</span> <span class="o">=</span> <span class="s2">&quot;DT_B0/&quot;</span>

<span class="c1"># 2) Use the dt_results dataframe to generate benchmark files</span>
<span class="n">ace_utils</span><span class="o">.</span><span class="n">generate_bench_ml_xs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dt_results</span><span class="p">,</span> <span class="s2">&quot;U233_MET_FAST_001&quot;</span><span class="p">,</span> <span class="n">to_scale</span><span class="p">,</span> <span class="n">dt_ml_ace_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Under the hood, the ace utilities performs several things:</p>
<ol class="arabic simple" start="0">
<li><p>Creates a new directory with the <cite>model_name</cite> as the name within <cite>dt_ml_ace_dir</cite></p></li>
<li><p>Search for the queried benchmark template</p></li>
<li><p>Reads the composition and extracts isotopes for which ML cross sections are needed</p></li>
<li><p>Loads the model and scaler using the paths in the <cite>dt_results</cite></p></li>
<li><p>Generates and processes cross sections</p></li>
<li><p>Creates the <cite>.ace</cite> files for the ML-generated cross sections and copies other needed isotopes from the main ACE directory</p></li>
<li><p>Creates the <cite>.xsdir</cite> file needed by SERPENT2</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The benchmark name is based on the Benchmark Catalog. If a benchmark of choice is not incldued you can include your own by following the instructions in the Benchmarks documentation.</p>
</div>
<p>Next, we can generate a <cite>bash</cite> script that will allow us to run all benchmark input files (in this case is just one) and transform
the resulting <cite>.m</cite> file into a <cite>.mat</cite> file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ace_utils</span><span class="o">.</span><span class="n">generate_serpent_bash</span><span class="p">(</span><span class="n">dt_ml_ace_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>The generated bash script will be saved in the same directory (dt_ml_ace_dir).</p>
</div>
<div class="section" id="validating-the-ml-models">
<h2>5. Validating the ML Models<a class="headerlink" href="#validating-the-ml-models" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both SERPENT2 and MATLAB need to be installed for the this section to work. MCNP is not supported.</p>
</div>
<p>You can run your SERPENT2 calculations by running the generated <cite>bash</cite> script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># navigate to the path where the bash script is</span>
<span class="nb">cd</span> path/to/dt_ml_ace_dir/

<span class="c1"># run the script</span>
./serpent_script.sh
</pre></div>
</div>
<p>Once finished, you can gather all results using a simple <cite>ace_utils</cite> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># gather results</span>
<span class="n">dt_jezebel_results</span> <span class="o">=</span> <span class="n">ace_utils</span><span class="o">.</span><span class="n">gather_benchmark_results</span><span class="p">(</span><span class="n">dt_ml_ace_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting <cite>DataFrame</cite> contains the model name, benchmark name, the multiplication factor, and the error.</p>
</div>
<div class="section" id="next-steps">
<h2>6. Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Congratulations, you have performed an end-to-end ML-enhanced nuclear data evaluation using the U-233 Jezebel Benchmark. These are just some of
the general submodules that NucML offers to help you navigate through the evaluation pipeline. Try going through the
<a class="reference internal" href="navigating-the-nde.html#navigating-the-nde-label"><span class="std std-ref">Navigating the NDE</span></a> section for more information and tutorials.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="navigating-the-nde.html" class="btn btn-neutral float-right" title="Loading Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation-guide.html" class="btn btn-neutral float-left" title="Installation Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Pedro Jr. Vicente-Valdez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>